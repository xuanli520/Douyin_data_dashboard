# 抖音数据后台可视化中台 - 系统架构设计
---

## 1. 项目概述

### 1.1 业务背景
基于抖店平台数据，构建自动化数据采集、处理、分析与展示的可视化中台，实现：
- 订单数据、商品数据、销售数据等核心指标自动抓取与分析
- 定时任务调度与ETL处理流程
- 完善的权限体系与风险预警机制
- 灵活的报表导出与数据看板展示

### 1.2 技术选型
- **后端框架**: FastAPI (Python 3.12+)
- **架构模式**: 领域驱动设计 (DDD)
- **数据库**: PostgreSQL + Redis
- **认证授权**: JWT + RBAC
- **任务调度**: Celery + Redis
- **部署方式**: Docker容器化
- **前端框架**: React/Vue (待定)

---

## 2. 系统架构图

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          客户端层 (Client Layer)                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  Web管理端  │  │  移动端H5   │  │  数据大屏   │  │  API调用端  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         API网关层 (Gateway Layer)                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  • 负载均衡 (Nginx/Traefik)                                      │   │
│  │  • 认证授权中间件                                                 │   │
│  │  • 限流熔断 (Redis)                                               │   │
│  │  • 请求路由与分发                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         应用服务层 (Application Layer)                    │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    FastAPI 后端服务                               │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │   │
│  │  │ 账号权限 │ │ 数据接入 │ │ 任务调度 │ │ 指标看板 │          │   │
│  │  │  模块    │ │  模块    │ │  模块    │ │  模块    │          │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘          │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │   │
│  │  │ 风险预警 │ │ 报表导出 │ │ 系统运维 │ │ 数据导出 │          │   │
│  │  │  模块    │ │  模块    │ │  模块    │ │  模块    │          │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         领域服务层 (Domain Layer)                         │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐  │
│  │  认证领域    │ │  用户领域    │ │  数据领域    │ │  指标领域    │  │
│  │  (Auth)      │ │  (Users)     │ │  (Data)      │ │  (Metrics)   │  │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘  │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐  │
│  │  任务领域    │ │  预警领域    │ │  报表领域    │ │  系统领域    │  │
│  │  (Tasks)     │ │  (Alerts)    │ │  (Reports)   │ │  (System)    │  │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         基础设施层 (Infrastructure Layer)                 │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │   │
│  │  │  PostgreSQL │  │    Redis    │  │  Celery     │             │   │
│  │  │  主数据库   │  │  缓存/队列  │  │  任务队列   │             │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │   │
│  │  │  MinIO/S3   │  │  Celery     │  │  日志系统   │             │   │
│  │  │  文件存储   │  │  Beat调度   │  │  (Loguru)   │             │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘             │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          外部数据源 (External Sources)                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │
│  │  抖店导出表 │  │  截图/网页  │  │  人工维护表 │  │  第三方API  │   │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 数据流向图

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  数据采集层  │ ──▶ │  数据处理层  │ ──▶ │  数据存储层  │
│  (ETL)       │     │  (清洗转换)  │     │  (PostgreSQL)│
└──────────────┘     └──────────────┘     └──────────────┘
                          │
                          ▼
                   ┌──────────────┐
                   │  指标计算层  │
                   │  (Metrics)   │
                   └──────────────┘
                          │
                          ▼
┌──────────────┐     ┌──────────────┐
│  预警通知    │ ◀── │  数据展示层  │
│  (Alerts)    │     │  (Dashboard) │
└──────────────┘     └──────────────┘
```

---

## 3. 目录结构设计

### 3.1 整体目录结构

```
douyin-data-platform/
├── .copier/                          # Copier模板配置
├── .github/                          # GitHub配置
│   ├── workflows/
│   │   ├── ci.yml                    # CI流水线
│   │   └── cd.yml                    # CD部署流水线
│   └── copilot-instructions.md       # GitHub Copilot指令
├── docker/                           # Docker配置
│   ├── docker-compose.yml            # 生产环境配置
│   ├── docker-compose.dev.yml        # 开发环境配置
│   ├── docker-compose.prod.yml       # 预发布环境
│   ├── Dockerfile                    # 应用Dockerfile
│   ├── Dockerfile.worker             # Celery Worker Dockerfile
│   └── nginx/
│       ├── default.conf              # Nginx配置
│       └── ssl/                      # SSL证书
├── migrations/                       # 数据库迁移 (alembic)
├── scripts/                          # 脚本工具
│   ├── init_db.py                    # 数据库初始化
│   ├── seed_data.py                  # 种子数据导入
│   ├── backup.sh                     # 备份脚本
│   └── restore.sh                    # 恢复脚本
├── src/                              # 源代码主目录
│   ├── __init__.py
│   ├── config.py                     # 应用配置
│   ├── session.py                    # 数据库会话管理
│   ├── exceptions.py                 # 全局异常定义
│   ├── responses.py                  # 统一响应格式
│   ├── retry.py                      # 重试机制封装
│   ├── cache.py                      # 缓存协议和实现
│   ├── logging.py                    # 日志配置
│   │
│   ├── api/                          # 表示层 - HTTP API
│   │   ├── __init__.py
│   │   ├── deps.py                   # 依赖注入
│   │   ├── middlewares.py            # 中间件
│   │   │
│   │   ├── v1/                       # API v1版本
│   │   │   ├── __init__.py
│   │   │   ├── router.py             # 主路由
│   │   │   │
│   │   │   ├── auth/                 # 认证模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py          # 登录/登出
│   │   │   │   └── schemas.py        # 请求/响应Schema
│   │   │   │
│   │   │   ├── users/                # 用户管理模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── roles/                # 角色权限模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── dashboard/            # 数据看板模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── metrics/              # 指标分析模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── orders/               # 订单数据模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── products/             # 商品数据模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── sales/                # 销售数据模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── data_source/          # 数据源管理模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── data_import/          # 数据导入模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── scraping/             # 数据抓取模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── tasks/                # 任务调度模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── alerts/               # 风险预警模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── reports/              # 报表中心模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── exports/              # 导出管理模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── system/               # 系统运维模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   ├── logs/                 # 日志审计模块
│   │   │   │   ├── __init__.py
│   │   │   │   ├── router.py
│   │   │   │   ├── views.py
│   │   │   │   └── schemas.py
│   │   │   │
│   │   │   └── notifications/        # 通知渠道模块
│   │   │       ├── __init__.py
│   │   │       ├── router.py
│   │   │       ├── views.py
│   │   │       └── schemas.py
│   │   │
│   │   └── v2/                       # API v2版本 (预留)
│   │       └── __init__.py
│   │
│   ├── core/                         # 核心业务逻辑层
│   │   ├── __init__.py
│   │   ├── security.py               # 安全相关 (加密、签名)
│   │   ├── pagination.py             # 分页封装
│   │   ├── permissions.py            # 权限检查器
│   │   └── scheduler.py              # 调度器配置
│   │
│   ├── shared/                       # 跨领域共享模块
│   │   ├── __init__.py
│   │   ├── errors.py                 # 自定义错误码
│   │   ├── constants.py              # 常量定义
│   │   ├── enums.py                  # 枚举类型
│   │   ├── utils.py                  # 工具函数
│   │   └── mixins.py                 # Mixin类
│   │
│   └── domains/                      # 领域层 (DDD)
│       ├── __init__.py
│       │
│       ├── auth/                     # 认证领域
│       │   ├── __init__.py
│       │   ├── entities.py           # 实体
│       │   ├── repositories.py       # 仓储接口
│       │   ├── services.py           # 领域服务
│       │   ├── events.py             # 领域事件
│       │   ├── models.py             # ORM模型
│       │   ├── schemas.py            # Pydantic Schema
│       │   └── specs.py              # 规格模式
│       │
│       ├── users/                    # 用户领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── roles/                    # 角色权限领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── data_source/              # 数据源领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── data_import/              # 数据导入领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── scraping/                 # 数据抓取领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── tasks/                    # 任务调度领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── metrics/                  # 指标领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── orders/                   # 订单数据领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── products/                 # 商品数据领域
│       │   ├── __init__.py
│       │   ├── entities.py
│      1, entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── sales/                    # 销售数据领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── alerts/                   # 风险预警领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── reports/                  # 报表领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── exports/                  # 导出领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       ├── system/                   # 系统运维领域
│       │   ├── __init__.py
│       │   ├── entities.py
│       │   ├── repositories.py
│       │   ├── services.py
│       │   ├── events.py
│       │   ├── models.py
│       │   ├── schemas.py
│       │   └── specs.py
│       │
│       └── logs/                     # 日志审计领域
│           ├── __init__.py
│           ├── entities.py
│           ├── repositories.py
│           ├── services.py
│           ├── events.py
│           ├── models.py
│           ├── schemas.py
│           └── specs.py
│
├── tasks/                            # Celery异步任务
│   ├── __init__.py
│   ├── celery_app.py                 # Celery应用配置
│   ├── base.py                       # 任务基类
│   │
│   ├──采集任务                        # 数据采集任务
│   │   ├── __init__.py
│   │   ├── douyin_orders.py          # 抖店订单采集
│   │   ├── douyin_products.py        # 抖店商品采集
│   │   ├── douyin_sales.py           # 抖店销售采集
│   │   ├── screenshot_scraper.py     # 截图数据提取
│   │   └── web_scraper.py            # 网页源码抓取
│   │
│   ├──处理任务                        # ETL处理任务
│   │   ├── __init__.py
│   │   ├── etl_orders.py             # 订单ETL
│   │   ├── etl_products.py           # 商品ETL
│   │   ├── etl_sales.py              # 销售ETL
│   │   └── data_cleaning.py          # 数据清洗
│   │
│   ├──指标任务                        # 指标计算任务
│   │   ├── __init__.py
│   │   ├── calculate_metrics.py      # 指标计算
│   │   ├── aggregate_metrics.py      # 指标聚合
│   │   └── refresh_dashboard.py      # 看板刷新
│   │
│   ├──导出任务                        # 报表导出任务
│   │   ├── __init__.py
│   │   ├── generate_report.py        # 报表生成
│   │   ├── export_data.py            # 数据导出
│   │   └── send_notification.py      # 通知发送
│   │
│   └──维护任务                        # 系统维护任务
│       ├── __init__.py
│       ├── data_retention.py         # 数据保留策略
│       ├── cleanup_temp.py           # 临时数据清理
│       ├── backup_data.py            # 数据备份
│       └── health_check.py           # 健康检查
│
├── services/                         # 应用服务层
│   ├── __init__.py
│   ├── auth_service.py               # 认证服务
│   ├── user_service.py               # 用户服务
│   ├── role_service.py               # 角色权限服务
│   ├── data_service.py               # 数据接入服务
│   ├── task_service.py               # 任务调度服务
│   ├── metric_service.py             # 指标分析服务
│   ├── alert_service.py              # 风险预警服务
│   ├── report_service.py             # 报表服务
│   ├── export_service.py             # 导出服务
│   └── system_service.py             # 系统运维服务
│
├── repositories/                     # 仓储实现层
│   ├── __init__.py
│   ├── auth_repository.py            # 认证仓储
│   ├── user_repository.py            # 用户仓储
│   ├── role_repository.py            # 角色仓储
│   ├── data_source_repository.py     # 数据源仓储
│   ├── task_repository.py            # 任务仓储
│   ├── metric_repository.py          # 指标仓储
│   ├── alert_repository.py           # 预警仓储
│   ├── report_repository.py          # 报表仓储
│   └── system_repository.py          # 系统仓储
│
├── middleware/                       # 中间件层
│   ├── __init__.py
│   ├── auth_middleware.py            # 认证中间件
│   ├── permission_middleware.py      # 权限中间件
│   ├── rate_limit_middleware.py      # 限流中间件
│   ├── logging_middleware.py         # 日志中间件
│   ├── cors_middleware.py            # CORS中间件
│   └── compression_middleware.py     # 压缩中间件
│
├── utils/                            # 工具模块
│   ├── __init__.py
│   ├── helpers.py                    # 辅助函数
│   ├── validators.py                 # 验证器
│   ├── formatters.py                 # 格式化工具
│   ├── calculators.py                # 计算工具
│   ├── converters.py                 # 转换工具
│   └── parsers.py                    # 解析工具
│
├── templates/                        # 报告模板
│   ├── __init__.py
│   ├── daily_report.html             # 日报模板
│   ├── weekly_report.html            # 周报模板
│   ├── monthly_report.html           # 月报模板
│   └── alert_notification.html       # 预警通知模板
│
├── static/                           # 静态文件
│   ├── css/
│   │   └── report.css                # 报告样式
│   ├── js/
│   │   └── report.js                 # 报告脚本
│   └── images/
│       └── logo.png                  # Logo
│
├── tests/                            # 测试目录
│   ├── __init__.py
│   ├── conftest.py                   # 测试配置
│   ├── fixtures/                     # 测试数据
│   │   ├── __init__.py
│   │   ├── test_data.json
│   │   └── mock_responses.py
│   │
│   ├── unit/                         # 单元测试
│   │   ├── __init__.py
│   │   ├── test_auth/
│   │   ├── test_users/
│   │   ├── test_roles/
│   │   ├── test_tasks/
│   │   ├── test_metrics/
│   │   └── test_alerts/
│   │
│   ├── integration/                  # 集成测试
│   │   ├── __init__.py
│   │   ├── test_api/
│   │   ├── test_tasks/
│   │   └── test_etl/
│   │
│   └── e2e/                          # 端到端测试
│       ├── __init__.py
│       └── test_flows/
│
├── docs/                             # 文档目录
│   ├── api/                          # API文档
│   │   ├── openapi.json
│   │   └── redoc.html
│   ├── architecture/                 # 架构文档
│   │   └── system_architecture.md
│   ├── database/                     # 数据库文档
│   │   ├── schema.md
│   │   └── er_diagram.png
│   ├── deployment/                   # 部署文档
│   │   └── docker_deployment.md
│   └── user_guide/                   # 用户指南
│       └── usage_manual.md
│
├── logs/                             # 日志目录
│   ├── app/                          # 应用日志
│   │   ├── app.log
│   │   └── app.log.1
│   ├── tasks/                        # 任务日志
│   │   ├── task.log
│   │   └── task.log.1
│   └── access/                       # 访问日志
│       ├── access.log
│       └── access.log.1
│
├── data/                             # 数据目录
│   ├── raw/                          # 原始数据 (临时)
│   │   ├── orders/
│   │   ├── products/
│   │   └── sales/
│   │
│   ├── processed/                    # 处理后数据
│   │   ├── daily/
│   │   ├── weekly/
│   │   └── monthly/
│   │
│   ├── backup/                       # 备份数据
│   │   ├── full/
│   │   └── incremental/
│   │
│   ├── exports/                      # 导出文件
│   │   ├── reports/
│   │   └── temp/
│   │
│   └── temp/                         # 临时文件
│       └── upload/
│
├── models/                           # 数据库模型
│   ├── __init__.py
│   ├── base.py                       # 基类模型
│   ├── mixins.py                     # Mixin模型
│   ├── auth.py                       # 认证模型
│   ├── users.py                      # 用户模型
│   ├── roles.py                      # 角色模型
│   ├── data_source.py                # 数据源模型
│   ├── tasks.py                      # 任务模型
│   ├── metrics.py                    # 指标模型
│   ├── orders.py                     # 订单模型
│   ├── products.py                   # 商品模型
│   ├── sales.py                      # 销售模型
│   ├── alerts.py                     # 预警模型
│   ├── reports.py                    # 报表模型
│   ├── exports.py                    # 导出模型
│   └── system.py                     # 系统模型
│
├── schemas/                          # Pydantic Schema
│   ├── __init__.py
│   ├── base.py                       # 基类Schema
│   ├── auth.py                       # 认证Schema
│   ├── users.py                      # 用户Schema
│   ├── roles.py                      # 角色Schema
│   ├── data_source.py                # 数据源Schema
│   ├── data_import.py                # 数据导入Schema
│   ├── scraping.py                   # 数据抓取Schema
│   ├── tasks.py                      # 任务Schema
│   ├── metrics.py                    # 指标Schema
│   ├── orders.py                     # 订单Schema
│   ├── products.py                   # 商品Schema
│   ├── sales.py                      # 销售Schema
│   ├── alerts.py                     # 预警Schema
│   ├── reports.py                    # 报表Schema
│   ├── exports.py                    # 导出Schema
│   ├── system.py                     # 系统Schema
│   └── logs.py                       # 日志Schema
│
├── .env                              # 环境变量 (本地)
├── .env.example                      # 环境变量示例
├── .env.prod                         # 生产环境变量
├── .env.test                         # 测试环境变量
├── .gitignore
├── .pre-commit-config.yaml
├── alembic.ini                       # 数据库迁移配置
├── pyproject.toml                    # Python项目配置
├── justfile                          # 任务运行器
├── README.md                         # 项目说明
└── AGENTS.md                         # Agent指令源文件
```

---

## 4. 核心模块详细设计

### 4.1 账号与权限模块

#### 4.1.1 功能列表

| 功能 | 描述 | 角色权限 |
|------|------|----------|
| 登录/退出 | 验证码/密码登录、Token刷新、退出登录 | 所有角色 |
| 用户管理 | 创建/停用账号、重置密码、分配角色 | Super/Admin |
| 角色权限(RBAC) | 配置角色、数据权限、菜单权限 | Super |
| 操作审计 | 关键操作留痕、登录日志、导出审计 | Super |

#### 4.1.2 API端点

```
POST   /api/v1/auth/login              # 用户登录
POST   /api/v1/auth/logout             # 用户登出
POST   /api/v1/auth/refresh            # 刷新Token
POST   /api/v1/auth/verify             # 验证Token

GET    /api/v1/users                   # 用户列表
POST   /api/v1/users                   # 创建用户
GET    /api/v1/users/{id}              # 用户详情
PUT    /api/v1/users/{id}              # 更新用户
DELETE /api/v1/users/{id}              # 删除用户
PUT    /api/v1/users/{id}/password     # 重置密码

GET    /api/v1/roles                   # 角色列表
POST   /api/v1/roles                   # 创建角色
GET    /api/v1/roles/{id}              # 角色详情
PUT    /api/v1/roles/{id}              # 更新角色
DELETE /api/v1/roles/{id}              # 删除角色
GET    /api/v1/roles/{id}/permissions  # 角色权限
PUT    /api/v1/roles/{id}/permissions  # 更新权限

GET    /api/v1/logs/audit              # 审计日志
GET    /api/v1/logs/login              # 登录日志
```

### 4.2 数据接入与维护模块

#### 4.2.1 功能列表

| 功能 | 描述 | 角色权限 |
|------|------|----------|
| 数据源管理 | 配置抖店导出表、截图抓取、人工表三类数据源 | Super/Admin |
| 数据导入/上传 | 上传导出表、字段映射、导入校验、失败回滚 | Super/Admin |
| 抓取规则配置 | 截图/网页源码特征提取规则、更新频率、失败告警 | Super/Admin |
| 人工数据录入 | 补录/修正人工表、版本记录、审批(可选) | Admin/User |
| 数据质量监控 | 缺失/重复/口径异常提示、数据延迟提示 | Super/Admin |

#### 4.2.2 数据源类型

```
数据源类型:
├── 抖店导出表 (DouyinExport)
│   ├── 订单数据 (Orders)
│   ├── 商品数据 (Products)
│   └── 销售数据 (Sales)
│
├── 截图/网页源码 (Scraped)
│   ├── 截图数据 (Screenshots)
│   └── 网页源码 (WebSource)
│
└── 人工维护表 (Manual)
    ├── 竞品数据 (Competitor)
    └── 用户画像 (UserProfile)
```

#### 4.2.3 API端点

```
# 数据源管理
GET    /api/v1/data-sources            # 数据源列表
POST   /api/v1/data-sources            # 创建数据源
GET    /api/v1/data-sources/{id}       # 数据源详情
PUT    /api/v1/data-sources/{id}       # 更新数据源
DELETE /api/v1/data-sources/{id}       # 删除数据源

# 数据导入
POST   /api/v1/data-import/upload      # 上传文件
POST   /api/v1/data-import/parse       # 解析文件
POST   /api/v1/data-import/validate   # 验证数据
POST   /api/v1/data-import/confirm    # 确认导入
GET    /api/v1/data-import/history    # 导入历史

# 抓取规则
GET    /api/v1/scraping/rules          # 抓取规则列表
POST   /api/v1/scraping/rules          # 创建抓取规则
GET    /api/v1/scraping/rules/{id}     # 规则详情
PUT    /api/v1/scraping/rules/{id}     # 更新规则
DELETE /api/v1/scraping/rules/{id}     # 删除规则
POST   /api/v1/scraping/rules/{id}/test # 测试规则

# 人工数据
GET    /api/v1/manual-data             # 人工数据列表
POST   /api/v1/manual-data             # 录入数据
PUT    /api/v1/manual-data/{id}        # 更新数据
DELETE /api/v1/manual-data/{id}        # 删除数据
POST   /api/v1/manual-data/{id}/approve # 审批(可选)

# 数据质量
GET    /api/v1/data-quality/issues     # 质量问题列表
GET    /api/v1/data-quality/stats      # 数据质量统计
POST   /api/v1/data-quality/check      # 触发质量检查
```

### 4.3 任务与调度模块

#### 4.3.1 功能列表

| 功能 | 描述 | 角色权限 |
|------|------|----------|
| 定时任务管理 | 按需求配置定时任务、触发关键环节 | Super/Admin |
| 任务运行监控 | 运行状态、耗时、重试、失败原因 | Super/Admin |
| 采集/计算日志 | ETL/指标计算日志、下载/查看 | Super/Admin |

#### 4.3.2 任务类型

```
任务类型:
├── 采集任务 (Collection Tasks)
│   ├── douyin_orders_collect        # 抖店订单采集
│   ├── douyin_products_collect      # 抖店商品采集
│   ├── douyin_sales_collect         # 抖店销售采集
│   ├── screenshot_collect           # 截图数据提取
│   └── web_source_collect           # 网页源码抓取
│
├── 处理任务 (Processing Tasks)
│   ├── etl_orders                   # 订单ETL
│   ├── etl_products                 # 商品ETL
│   ├── etl_sales                    # 销售ETL
│   └── data_cleaning                # 数据清洗
│
├── 指标任务 (Metric Tasks)
│   ├── calculate_daily_metrics      # 日指标计算
│   ├── calculate_weekly_metrics     # 周指标计算
│   ├── calculate_monthly_metrics    # 月指标计算
│   └── refresh_dashboard            # 看板刷新
│
├── 导出任务 (Export Tasks)
│   ├── generate_daily_report        # 日报生成
│   ├── generate_weekly_report       # 周报生成
│   ├── generate_monthly_report      # 月报生成
│   └── export_data                  # 数据导出
│
└── 维护任务 (Maintenance Tasks)
    ├── cleanup_temp_data            # 临时数据清理
    ├── data_backup                  # 数据备份
    ├── health_check                 # 健康检查
    └── alert_check                  # 预警检查
```

#### 4.3.3 API端点

```
# 定时任务管理
GET    /api/v1/tasks                   # 任务列表
POST   /api/v1/tasks                   # 创建任务
GET    /api/v1/tasks/{id}              # 任务详情
PUT    /api/v1/tasks/{id}              # 更新任务
DELETE /api/v1/tasks/{id}              # 删除任务
POST   /api/v1/tasks/{id}/enable       # 启用任务
POST   /api/v1/tasks/{id}/disable      # 禁用任务
POST   /api/v1/tasks/{id}/run          # 手动触发任务

# 任务执行记录
GET    /api/v1/tasks/{id}/executions   # 执行记录列表
GET    /api/v1/tasks/{id}/executions/{eid} # 执行详情
POST   /api/v1/tasks/{id}/executions/{eid}/retry # 重试执行

# 任务监控
GET    /api/v1/tasks/monitor           # 任务监控状态
GET    /api/v1/tasks/stats

# 日志 # 任务统计
GET    /api/v1/tasks/{id}/logs         # 任务日志
GET    /api/v1/tasks/logs/download     # 下载日志
```

### 4.4 指标与看板模块

#### 4.4.1 功能列表

| 功能 | 描述 | 角色权限 |
|------|------|----------|
| 经营总览Dashboard | 店铺体验分、投诉总量、工作总量等关键指标总览 | Admin/User |
| 电商罗盘分析 | 趋势、分渠道/分店铺、Top/Bottom、钻取明细 | Admin/User |
| 投诉分析 | 投诉量趋势、原因分类、处理时效、异常点 | Admin/User |
| 工作量与效率 | 工单/任务量、处理效率、人员/团队对比 | Admin/User |
| 明细数据查询 | 多条件筛选、分页、字段自定义、导出 | Admin/User |

#### 4.4.2 指标体系

```
指标分类:
├── 经营指标 (Business Metrics)
│   ├── 店铺体验分 (Shop Score)
│   ├── GMV (Gross Merchandise Volume)
│   ├── 订单量 (Order Count)
│   ├── 客单价 (Average Order Value)
│   └── 转化率 (Conversion Rate)
│
├── 订单指标 (Order Metrics)
│   ├── 订单金额 (Order Amount)
│   ├── 订单数量 (Order Quantity)
│   ├── 退款金额 (Refund Amount)
│   ├── 退款率 (Refund Rate)
│   └── 完单率 (Completion Rate)
│
├── 商品指标 (Product Metrics)
│   ├── 商品数 (Product Count)
│   ├── 在售商品数 (Active Products)
│   ├── 商品销量 (Product Sales)
│   └── 商品销售额 (Product Revenue)
│
├── 售后指标 (After-sales Metrics)
│   ├── 投诉量 (Complaint Count)
│   ├── 投诉率 (Complaint Rate)
│   ├── 售后处理时长 (Processing Time)
│   └── 满意度 (Satisfaction Score)
│
└── 运营指标 (Operation Metrics)
    ├── 工单量 (Ticket Count)
    ├── 处理效率 (Processing Efficiency)
    ├── 响应时间 (Response Time)
    └── 团队产出 (Team Output)
```

#### 4.4.3 API端点

```
# 经营总览
GET    /api/v1/dashboard/overview      # 经营总览数据
GET    /api/v1/dashboard/kpis          # KPI指标列表
GET    /api/v1/dashboard/charts        # 图表数据

# 指标分析
GET    /api/v1/metrics                 # 指标列表
GET    /api/v1/metrics/{id}            # 指标详情
GET    /api/v1/metrics/trend           # 趋势数据
GET    /api/v1/metrics/comparison      # 对比数据
GET    /api/v1/metrics/ranking         # 排名数据
POST   /api/v1/metrics/custom          # 自定义指标

# 订单分析
GET    /api/v1/orders/summary          # 订单汇总
GET    /api/v1/orders/trend            # 订单趋势
GET    /api/v1/orders/analysis         # 订单分析
GET    /api/v1/orders/details          # 订单明细

# 商品分析
GET    /api/v1/products/summary        # 商品汇总
GET    /api/v1/products/trend          # 商品趋势
GET    /api/v1/products/analysis       # 商品分析
GET    /api/v1/products/ranking        # 商品排名
GET    /api/v1/products/details        # 商品明细

# 销售分析
GET    /api/v1/sales/summary           # 销售汇总
GET    /api/v1/sales/trend             # 销售趋势
GET    /api/v1/sales/analysis          # 销售分析
GET    /api/v1/sales/by-channel        # 渠道销售
GET    /api/v1/sales/by-shop           # 店铺销售

# 投诉分析
GET    /api/v1/complaints/summary      # 投诉汇总
GET    /api/v1/complaints/trend        # 投诉趋势
GET    /api/v1/complaints/analysis     # 投诉分析
GET    /api/v1/complaints/categories   # 投诉分类
GET    /api/v1/complaints/details      # 投诉明细

# 工作量分析
GET    /api/v1/workload/summary        # 工作量汇总
GET    /api/v1/workload/trend          # 工作量趋势
GET    /api/v1/workload/by-person      # 个人工作量
GET    /api/v1/workload/by-team        # 团队工作量
GET    /api/v1/workload/efficiency     # 效率分析

# 明细查询
POST   /api/v1/query/orders            # 订单明细查询
POST   /api/v1/query/products          # 商品明细查询
POST   /api/v1/query/sales             # 销售明细查询
POST   /api/v1/query/complaints        # 投诉明细查询
GET    /api/v1/query/export            # 查询结果导出
```

### 4.5 风险预警模块

#### 4.5.1 功能列表

| 功能 | 描述 | 角色权限 |
|------|------|----------|
| 预警规则配置 | 阈值/波动/延迟/漏抓规则配置 | Super/Admin |
| 预警中心 | 预警列表、等级、处置状态、备注与指派 | Admin/User |
| 通知渠道配置 | 企业微信/邮件/短信等通知方式配置 | Super/Admin |

#### 4.5.2 预警类型

```
预警类型:
├── 业务预警 (Business Alerts)
│   ├── 阈值预警 (Threshold Alert)      # 指标超过阈值
│   ├── 波动预警 (Fluctuation Alert)    # 指标波动异常
│   └── 趋势预警 (Trend Alert)          # 趋势反转预警
│
├── 数据预警 (Data Alerts)
│   ├── 延迟预警 (Delay Alert)          # 数据延迟到达
│   ├── 漏抓预警 (Missing Alert)        # 数据抓取遗漏
│   └── 失败预警 (Failure Alert)        # 任务执行失败
│
└── 系统预警 (System Alerts)
    ├── 服务预警 (Service Alert)        # 服务不可用
    ├── 容量预警 (Capacity Alert)       # 存储空间不足
    └── 性能预警 (Performance Alert)    # 响应时间过长
```

#### 4.5.3 预警等级

```
预警等级:
├── P0 - 紧急 (Critical)        # 立即处理，影响核心业务
├── P1 - 高 (High)              # 尽快处理，影响业务
├── P2 - 中 (Medium)            # 计划处理，略有影响
└── P3 - 低 (Low)               # 关注即可，潜在风险
```

#### 4.5.4 API端点

```
# 预警规则
GET    /api/v1/alerts/rules             # 规则列表
POST   /api/v1/alerts/rules             # 创建规则
GET    /api/v1/alerts/rules/{id}        # 规则详情
PUT    /api/v1/alerts/rules/{id}        # 更新规则
DELETE /api/v1/alerts/rules/{id}        # 删除规则
POST   /api/v1/alerts/rules/{id}/enable # 启用规则
POST   /api/v1/alerts/rules/{id}/disable # 禁用规则

# 预警中心
GET    /api/v1/alerts                   # 预警列表
GET    /api/v1/alerts/{id}              # 预警详情
PUT    /api/v1/alerts/{id}              # 更新预警
POST   /api/v1/alerts/{id}/acknowledge  # 确认预警
POST   /api/v1/alerts/{id}/assign       # 指派预警
POST   /api/v1/alerts/{id}/resolve      # 解决预警
POST   /api/v1/alerts/{id}/feedback     # 反馈处理

# 通知渠道
GET    /api/v1/notifications/channels   # 渠道列表
POST   /api/v1/notifications/channels   # 创建渠道
PUT    /api/v1/notifications/channels/{id} # 更新渠道
DELETE /api/v1/notifications/channels/{id} # 删除渠道
POST   /api/v1/notifications/channels/{id}/test # 测试渠道
```

### 4.6 报表与导出模块

#### 4.6.1 功能列表

| 功能 | 描述 | 角色权限 |
|------|------|----------|
| 报表中心 | 日报/周报/月报生成与模板管理 | Admin/User |
| 导出管理 | 导出任务、历史记录、权限控制 | Admin/User |

#### 4.6.2 报表类型

```
报表类型:
├── 经营报表 (Business Reports)
│   ├── 日报 (Daily Report)
│   ├── 周报 (Weekly Report)
│   └── 月报 (Monthly Report)
│
├── 分析报表 (Analysis Reports)
│   ├── 销售分析报告 (Sales Analysis)
│   ├── 商品分析报告 (Product Analysis)
│   ├── 售后分析报告 (After-sales Analysis)
│   └── 运营分析报告 (Operation Analysis)
│
└── 数据导出 (Data Exports)
    ├── 订单数据导出 (Orders Export)
    ├── 商品数据导出 (Products Export)
    ├── 销售数据导出 (Sales Export)
    └── 定制导出 (Custom Export)
```

#### 4.6.3 API端点

```
# 报表中心
GET    /api/v1/reports                  # 报表列表
POST   /api/v1/reports                  # 创建报表
GET    /api/v1/reports/{id}             # 报表详情
DELETE /api/v1/reports/{id}             # 删除报表
POST   /api/v1/reports/generate         # 生成报表
POST   /api/v1/reports/{id}/download    # 下载报表
GET    /api/v1/reports/templates        # 报表模板

# 报表模板
GET    /api/v1/reports/templates        # 模板列表
POST   /api/v1/reports/templates        # 创建模板
PUT    /api/v1/reports/templates/{id}   # 更新模板
DELETE /api/v1/reports/templates/{id}   # 删除模板

# 导出管理
GET    /api/v1/exports                  # 导出任务列表
POST   /api/v1/exports                  # 创建导出任务
GET    /api/v1/exports/{id}             # 导出任务详情
DELETE /api/v1/exports/{id}             # 取消导出
POST   /api/v1/exports/{id}/download    # 下载导出文件
GET    /api/v1/exports/history          # 导出历史
```

### 4.7 系统设置与运维模块

#### 4.7.1 功能列表

| 功能 | 描述 | 角色权限 |
|------|------|----------|
| 数据保留策略 | 展示结果存一年；导入原始数据当天清理 | Super |
| 部署与环境配置 | 本地/云端参数、网络访问策略、域名/证书 | Super |
| 监控与告警 | 服务健康、容量、任务失败、延迟/漏抓告警 | Super/Admin |

#### 4.7.2 API端点

```
# 系统配置
GET    /api/v1/system/config            # 系统配置
PUT    /api/v1/system/config            # 更新配置

# 数据保留
GET    /api/v1/system/retention         # 保留策略
PUT    /api/v1/system/retention         # 更新策略

# 监控
GET    /api/v1/system/health            # 健康检查
GET    /api/v1/system/metrics           # 系统指标
GET    /api/v1/system/resources         # 资源使用
GET    /api/v1/system/tasks-status      # 任务状态

# 备份恢复
GET    /api/v1/system/backups           # 备份列表
POST   /api/v1/system/backups           # 创建备份
POST   /api/v1/system/backups/{id}/restore # 恢复备份
DELETE /api/v1/system/backups/{id}      # 删除备份

# 运维操作
POST   /api/v1/system/cleanup           # 清理操作
POST   /api/v1/system/migrate           # 数据迁移
POST   /api/v1/system/reload            # 重载配置
```

---

## 5. 数据库设计

### 5.1 核心数据表

```
核心数据表:
├── auth_users                         # 用户表
├── auth_roles                         # 角色表
├── auth_permissions                   # 权限表
├── auth_user_roles                    # 用户角色关联
├── auth_role_permissions              # 角色权限关联
│
├── data_sources                       # 数据源表
├── data_import_records                # 数据导入记录
├── scraping_rules                     # 抓取规则表
├── manual_data_records                # 人工数据记录
├── data_quality_issues                # 数据质量问题表
│
├── scheduled_tasks                    # 定时任务表
├── task_executions                    # 任务执行记录
├── task_logs                          # 任务日志表
│
├── metrics_definitions                # 指标定义表
├── metrics_values                     # 指标值表
├── metrics_calculations               # 指标计算记录
│
├── orders                             # 订单数据表
├── products                           # 商品数据表
├── sales                              # 销售数据表
├── complaints                         # 投诉数据表
├── workload_records                   # 工作量记录表
│
├── alert_rules                        # 预警规则表
├── alerts                             # 预警记录表
├── alert_notifications                # 预警通知记录
│
├── reports                            # 报表记录表
├── report_templates                   # 报表模板表
├── export_tasks                       # 导出任务表
│
├── audit_logs                         # 审计日志表
├── login_logs                         # 登录日志表
│
└── system_config                      # 系统配置表
```

### 5.2 ER图概要

```
┌─────────────┐       ┌─────────────┐
│   users     │───────│    roles    │
└─────────────┘       └─────────────┘
      │                     │
      │                     │
      ▼                     ▼
┌─────────────┐       ┌─────────────┐
│ permissions │<──────│   tasks     │
└─────────────┘       └─────────────┘
                           │
                           ▼
                   ┌─────────────┐
                   │  metrics    │
                   └─────────────┘
                           │
      ┌────────────────────┼────────────────────┐
      ▼                    ▼                    ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   orders    │     │  products   │     │   sales     │
└─────────────┘     └─────────────┘     └─────────────┘
      │                     │                    │
      └─────────────────────┼────────────────────┘
                            ▼
                   ┌─────────────┐
                   │   alerts    │
                   └─────────────┘
```

---

## 6. 部署架构

### 6.1 Docker Compose配置

```yaml
services:
  # 主应用
  app:
    build: .
    ports:
      - "8000:8000"
    environment:
      - ENVIRONMENT=production
    depends_on:
      - postgres
      - redis
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data

  # Celery Worker
  worker:
    build: .
    command: celery -A tasks worker
    depends_on:
      - postgres
      - redis
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data

  # Celery Beat (调度器)
  beat:
    build: .
    command: celery -A tasks beat
    depends_on:
      - redis
    volumes:
      - ./logs:/app/logs

  # PostgreSQL
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=douyin_data
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  # Redis
  redis:
    image: redis:7
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  # Nginx (反向代理)
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./docker/nginx:/etc/nginx/conf.d
      - ./static:/var/www/static
    depends_on:
      - app

volumes:
  postgres_data:
  redis_data:
```

---

## 7. 开发规范

### 7.1 代码规范

```
代码规范:
├── 命名规范
│   ├── 模块名: snake_case (如: data_import)
│   ├── 类名: PascalCase (如: DataImportService)
│   ├── 函数名: snake_case (如: import_data)
│   └── 变量名: snake_case (如: user_id)
│
├── 注释规范
│   ├── 模块注释: 模块功能说明
│   ├── 函数注释: 函数作用、参数、返回值
│   └── 行内注释: 复杂逻辑解释
│
└── 文档规范
    ├── API文档: FastAPI自动生成
    ├── 数据字典: 字段说明
    └── 架构文档: 设计和变更记录
```

### 7.2 Git工作流

```
Git分支策略:
├── main                    # 生产环境代码
├── develop                 # 开发环境代码
├── feature/*               # 功能分支
├── bugfix/*                # Bug修复分支
└── release/*               # 发布分支

提交规范:
├── feat: 新功能
├── fix: Bug修复
├── docs: 文档更新
├── refactor: 代码重构
├── test: 测试相关
├── chore: 构建/工具相关
└── perf: 性能优化
```

---

## 8. 扩展性设计

### 8.1 插件机制

```
插件目录结构:
plugins/
├── __init__.py
├── base.py                 # 插件基类
├── plugin_a/               # 插件A
│   ├── __init__.py
│   ├── plugin.py
│   └── config.yaml
└── plugin_b/               # 插件B
    ├── __init__.py
    ├── plugin.py
    └── config.yaml
```

### 8.2 消息队列集成

```
消息队列事件:
├── 数据采集完成
├── 数据处理完成
├── 指标计算完成
├── 预警触发
└── 报表生成完成
```

---

## 9. 性能优化建议

### 9.1 数据库优化

```
优化策略:
├── 索引优化
│   ├── 常用查询字段建立索引
│   └── 避免过多索引
│
├── 查询优化
│   ├── 使用分页查询
│   ├── 避免N+1查询
│   └── 使用批量操作
│
└── 缓存策略
    ├── Redis缓存热点数据
    └── 设置合理过期时间
```

### 9.2 任务队列优化

```
优化策略:
├── 任务拆分
│   ├── 大任务拆分为小任务
│   └── 任务粒度适中
│
├── 并发控制
│   ├── 控制并发数量
│   └── 避免资源竞争
│
└── 失败处理
    ├── 设置重试次数
    └── 失败告警通知
```

---

## 10. 安全设计

### 10.1 认证授权

```
安全措施:
├── JWT认证
│   ├── Token有效期设置
│   ├── Token刷新机制
│   └── 黑名单机制
│
├── RBAC权限
│   ├── 角色分级管理
│   ├── 数据权限控制
│   └── 操作权限验证
│
└── API安全
    ├── 请求签名验证
    ├── 限流保护
    └── SQL注入防护
```

### 10.2 数据安全

```
数据保护:
├── 传输安全
│   ├── HTTPS加密传输
│   └── 敏感数据加密
│
├── 存储安全
│   ├── 敏感数据脱敏
│   └── 定期备份
│
└── 访问控制
    ├── IP白名单
    └── 操作审计
```

---

## 11. 总结

本架构设计基于以下原则：

1. **模块化设计**: 每个功能模块独立，便于维护和扩展
2. **领域驱动**: 采用DDD架构，业务逻辑清晰
3. **松耦合**: 模块间通过接口通信，降低依赖
4. **高可用**: 支持Docker容器化部署，水平扩展
5. **安全性**: 完善的认证授权和审计机制
6. **可观测**: 完善的日志、监控和告警体系

